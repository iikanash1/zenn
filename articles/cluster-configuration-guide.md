---
title: "クラスタ構成とは？可用性・負荷分散を実現する仕組みを解説"
emoji: "🤷‍♂️"
type: "tech"
topics: ["cluster", "infrastructure", "server", "availability", "loadbalancing"]
published: false
---

## はじめに

今日上司にクラスタ構成についての話題を出されました。
Webサービスや社内システムを運用する上で、「サーバーが停止してサービスが利用できなくなる」事態は避けなければなりません。そのための重要な技術の一つ。それが**クラスタ構成**です。
クラスタ構成を組むことで、1台のサーバーが故障してもシステム全体を停止させることなく、サービスを提供し続けることができます。

この記事では、インフラの基本的な概念であるクラスタ構成について、その目的や種類、実現に必要な要素を分かりやすく解説します。

## クラスタ構成の目的

クラスタ構成は、複数のサーバーを連携させて、あたかも1つの高性能なサーバーであるかのように見せる技術です。主な目的は以下の3つです。

### 1. 高可用性 (High Availability)

クラスタ構成の最大の目的は**可用性**を高めることです。可用性とは、システムが停止することなく稼働し続ける能力を指します。

例えば、サーバーが1台しかない構成（スタンドアロン構成）では、そのサーバーが故障するとサービスは完全に停止してしまいます。
一方、クラスタ構成では、稼働中のサーバー（ノード）に障害が発生した場合、待機している別のサーバーが処理を自動的に引き継ぎます（**フェイルオーバー**）。これにより、システム全体のダウンタイムを最小限に抑え、サービスの継続性を確保します。

### 2. 負荷分散 (Load Balancing)

Webサイトへのアクセス集中など、単一のサーバーにかかる負荷を複数のサーバーに分散させることもクラスタ構成の重要な役割です。

各サーバーの負荷を均等に保つことで、レスポンスタイムの低下を防ぎ、安定したサービスを提供できます。特に大規模なWebサービスなどでは必須の技術です。

### 3. スケーラビリティ (Scalability)

サービスの成長に合わせてシステムを拡張していく際の柔軟性（スケーラビリティ）を確保できます。
サーバーの処理能力を向上させる方法には、サーバー自体のスペックを上げる**スケールアップ**と、サーバーの台数を増やす**スケールアウト**があります。クラスタ構成は、サーバー（ノード）を追加するだけで処理能力を向上できるため、スケールアウトを容易に実現します。

## 主なクラスタ構成の種類

クラスタ構成には、その目的によっていくつかの種類があります。

### 1. HAクラスタ (High Availability Cluster)

可用性を高めることを主な目的とした構成です。障害発生時にシステムをどう継続させるかによって、さらに2つの方式に分かれます。

- **Active-Standby構成**
  - 稼働系（Active）と待機系（Standby）のサーバーで構成されます。通常時はActiveサーバーのみが処理を行い、Standbyサーバーは待機しています。Activeサーバーに障害が発生すると、Standbyサーバーに処理が引き継がれます。
  - 構成がシンプルですが、待機系のサーバーリソースが平常時は利用されないという側面もあります。

- **Active-Active構成**
  - 複数のサーバーすべてが稼働系（Active）として処理を分担します。1台に障害が発生すると、残りのサーバーで処理を継続します。
  - すべてのサーバーリソースを有効活用でき、負荷分散も兼ねることができますが、構成は複雑になりがちです。

### 2. 負荷分散クラスタ (Load Balancing Cluster)

複数のサーバー間で処理の負荷を分散させることを目的とした構成です。ロードバランサーと呼ばれる装置が、外部からのリクエストを各サーバーに適切に振り分けます。これにより、特定のサーバーへの負荷集中を防ぎ、システム全体の処理能力と応答性を向上させます。

### 3. HPCクラスタ (High-Performance Computing Cluster)

科学技術計算やシミュレーションなど、膨大な計算能力を必要とする処理を行うためのクラスタです。多数のコンピュータを高速なネットワークで接続し、並列処理を行うことで、単一のコンピュータでは不可能な大規模計算を実現します。

## クラスタ構成の実現に必要な要素

クラスタ構成を実現するためには、一般的に以下の要素が必要となります。

- **共有ストレージ**
  - 複数のサーバー（ノード）が同じデータにアクセスするためのストレージ装置です。SAN (Storage Area Network) や NAS (Network Attached Storage) などが利用されます。フェイルオーバーが発生した際に、どのサーバーからでも一貫したデータを読み書きできることが重要です。

- **仮想IP (Virtual IP)**
  - クライアントがアクセスする際に使用される、物理的なサーバーに紐付かない仮想的なIPアドレスです。平常時は稼働系のサーバーに割り当てられていますが、障害発生時には待機系のサーバーにこのIPアドレスが引き継がれます。これにより、クライアントはサーバーの切り替わりを意識することなく、同じIPアドレスでサービスにアクセスし続けることができます。

- **クラスタソフトウェア**
  - 各サーバーの死活監視（ハートビート監視）、フェイルオーバーの制御、仮想IPの切り替えなど、クラスタ全体の動作を管理するソフトウェアです。「Pacemaker」や「Keepalived」などがオープンソースのクラスタソフトウェアとして有名です。

## まとめ

クラスタ構成は、システムの可用性、信頼性、拡張性を高めるための非常に重要な技術です。特に、停止することが許されないミッションクリティカルなシステムや、多くのユーザーが利用するWebサービスにおいては、今や当たり前の技術となっています。

本記事を通して、クラスタ構成の基本的な概念や重要性について理解を深める一助となれば幸いです。
